<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MonkeyPaw Game</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Creepster&display=swap');
        
        .monkeypaw-game * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .monkeypaw-game {
            font-family: 'Cinzel', 'Times New Roman', serif;
            background: 
                radial-gradient(circle at 20% 20%, rgba(139, 69, 19, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(105, 105, 105, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 0, 0, 0.8) 0%, transparent 50%),
                linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            height: 100vh;
            color: #d4af37;
            overflow: hidden;
            position: relative;
        }

        .monkeypaw-game::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 10% 10%, rgba(255, 140, 0, 0.1) 0%, transparent 30%),
                radial-gradient(circle at 90% 90%, rgba(255, 140, 0, 0.05) 0%, transparent 30%),
                radial-gradient(circle at 50% 50%, rgba(139, 69, 19, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .game-container {
            height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr auto;
            grid-template-areas: 
                "header"
                "chat"
                "input";
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header-section {
            grid-area: header;
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(212, 175, 55, 0.3);
            margin-bottom: 20px;
        }

        .game-title {
            font-family: 'Creepster', cursive;
            font-size: 2.5rem;
            color: #d4af37;
            text-shadow: 
                0 0 10px rgba(212, 175, 55, 0.8),
                0 0 20px rgba(212, 175, 55, 0.6),
                2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .paw-display {
            width: 150px;
            height: 180px;
            margin: 0 auto;
            font-size: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: 
                drop-shadow(0 0 10px rgba(212, 175, 55, 0.5))
                sepia(30%) 
                brightness(0.8);
            transition: all 0.3s ease;
        }

        .wishes-counter {
            font-size: 0.9rem;
            color: #8b7355;
            margin-top: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        #wishesRemaining {
            color: #ff6b6b;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .chat-container {
            grid-area: chat;
            background: 
                linear-gradient(145deg, rgba(0, 0, 0, 0.8) 0%, rgba(20, 20, 20, 0.9) 100%);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            box-shadow: 
                inset 0 0 20px rgba(212, 175, 55, 0.1),
                0 0 30px rgba(0, 0, 0, 0.8);
            overflow: hidden;
            position: relative;
        }

        .chat-messages {
            padding: 15px;
            overflow-y: auto;
            height: 100%;
            scrollbar-width: thin;
            scrollbar-color: rgba(212, 175, 55, 0.5) transparent;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(212, 175, 55, 0.5);
            border-radius: 4px;
        }

        .message {
            margin-bottom: 15px;
            animation: messageSlideIn 0.5s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .message-content {
            background: rgba(40, 20, 0, 0.8);
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.4);
            font-size: 14px;
            line-height: 1.6;
            color: #e6d7b8;
            box-shadow: 
                inset 0 1px 3px rgba(212, 175, 55, 0.2),
                0 2px 8px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .genie-message .message-content {
            background: 
                linear-gradient(135deg, 
                    rgba(139, 69, 19, 0.9) 0%, 
                    rgba(101, 67, 33, 0.9) 50%, 
                    rgba(160, 82, 45, 0.8) 100%);
            color: #f4e4bc;
            border: 1px solid rgba(212, 175, 55, 0.6);
            box-shadow: 
                inset 0 1px 3px rgba(255, 215, 0, 0.3),
                0 3px 12px rgba(139, 69, 19, 0.6);
        }

        .user-wish .message-content {
            background: 
                linear-gradient(135deg, 
                    rgba(25, 25, 60, 0.9) 0%, 
                    rgba(40, 40, 80, 0.8) 100%);
            color: #c9d1d9;
            border: 1px solid rgba(100, 149, 237, 0.4);
            margin-left: 15%;
            box-shadow: 
                inset 0 1px 3px rgba(100, 149, 237, 0.2),
                0 2px 8px rgba(25, 25, 60, 0.4);
        }

        .user-wish .message-content::before {
            content: "💭 ";
            font-size: 16px;
            margin-right: 5px;
        }

        .wish-input-container {
            grid-area: input;
            background: 
                linear-gradient(145deg, 
                    rgba(139, 69, 19, 0.4) 0%, 
                    rgba(101, 67, 33, 0.6) 50%, 
                    rgba(160, 82, 45, 0.4) 100%);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(212, 175, 55, 0.4);
            box-shadow: 
                inset 0 2px 8px rgba(0, 0, 0, 0.6),
                0 0 20px rgba(212, 175, 55, 0.3);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        #wishInput {
            flex: 1;
            padding: 12px 18px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(212, 175, 55, 0.5);
            border-radius: 25px;
            font-size: 16px;
            font-family: 'Cinzel', serif;
            color: #d4af37;
            outline: none;
            transition: all 0.3s ease;
        }

        #wishInput::placeholder {
            color: rgba(212, 175, 55, 0.6);
            font-style: italic;
        }

        #wishInput:focus {
            border-color: #d4af37;
            box-shadow: 
                0 0 15px rgba(212, 175, 55, 0.5),
                inset 0 2px 8px rgba(0, 0, 0, 0.4);
            background: rgba(0, 0, 0, 0.8);
        }

        #makeWishButton, #newPawButton {
            background: 
                linear-gradient(135deg, 
                    rgba(139, 69, 19, 0.9) 0%, 
                    rgba(212, 175, 55, 0.8) 50%, 
                    rgba(139, 69, 19, 0.9) 100%);
            color: #1a1a1a;
            border: 2px solid rgba(212, 175, 55, 0.8);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            font-family: 'Cinzel', serif;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            box-shadow: 
                0 4px 12px rgba(139, 69, 19, 0.6),
                inset 0 1px 3px rgba(255, 215, 0, 0.3);
        }

        #makeWishButton:hover, #newPawButton:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(212, 175, 55, 0.8),
                inset 0 2px 6px rgba(255, 215, 0, 0.4);
            border-color: #d4af37;
        }

        #makeWishButton:disabled {
            background: rgba(60, 60, 60, 0.6);
            color: rgba(212, 175, 55, 0.4);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            border-color: rgba(212, 175, 55, 0.2);
        }

        .typing-dots {
            display: inline-block;
            margin-left: 5px;
        }

        .typing-dots span {
            display: inline-block;
            animation: typing 1.4s infinite;
            animation-fill-mode: both;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .paw-display {
                width: 120px;
                height: 140px;
            }
            
            .user-wish .message-content {
                margin-left: 5%;
            }
            
            .wish-input-container {
                flex-direction: column;
                gap: 12px;
                padding: 15px;
            }
            
            #makeWishButton, #newPawButton {
                width: 100%;
                padding: 14px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="monkeypaw-game">
        <div class="game-container">
            <!-- Header Section -->
            <div class="header-section">
                <h1 class="game-title">Try and Beat the Monkey's Paw</h1>
                <div class="paw-display" id="pawDisplay">
                    <div id="paw-emoji">🖐️</div>
                </div>
                <div class="wishes-counter">
                    <span id="wishesRemaining">3</span> fingers remaining
                </div>
            </div>

            <!-- Chat Messages Area -->
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message genie-message">
                        <div class="message-content">
                            You have found the legendary Monkey's Paw. It will grant you exactly three wishes. Make your first wish...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wish Input -->
            <div class="wish-input-container" id="wishInputContainer">
                <input type="text" id="wishInput" placeholder="Speak your desire..." autocomplete="off" maxlength="500">
                <button id="makeWishButton">✨ Make Wish</button>
            </div>
        </div>
    </div>

    <script>
        // Self-contained MonkeyPaw Game for Website Builder with AI
        class MonkeyPawGame {
            constructor() {
                this.gameState = {
                    wishesUsed: 0,
                    maxWishes: 3,
                    gameOver: false,
                    wishes: []
                };
                
                // Encrypted API key (Base64 encoded with simple XOR)
                // Replace 'PLACEHOLDER_KEY' with your encrypted key using setup-encryption.html
                this.encryptedKey = 'PLACEHOLDER_KEY';
                this.keyOffset = 42; // Simple encryption offset
                
                this.pawDisplay = document.getElementById('pawDisplay');
                this.wishesRemaining = document.getElementById('wishesRemaining');
                this.wishInput = document.getElementById('wishInput');
                this.makeWishButton = document.getElementById('makeWishButton');
                this.wishInputContainer = document.getElementById('wishInputContainer');
                this.chatMessages = document.getElementById('chatMessages');
                
                this.init();
            }

            // Simple encryption/decryption utility
            decryptKey() {
                try {
                    if (this.encryptedKey === 'PLACEHOLDER_KEY') {
                        return null; // No key set, use fallbacks
                    }
                    const decoded = atob(this.encryptedKey);
                    let decrypted = '';
                    for (let i = 0; i < decoded.length; i++) {
                        decrypted += String.fromCharCode(decoded.charCodeAt(i) ^ this.keyOffset);
                    }
                    return decrypted;
                } catch (error) {
                    console.warn('Key decryption failed, using fallbacks');
                    return null;
                }
            }

            // Static method to encrypt a key (for setup purposes)
            static encryptKey(plainKey, offset = 42) {
                let encrypted = '';
                for (let i = 0; i < plainKey.length; i++) {
                    encrypted += String.fromCharCode(plainKey.charCodeAt(i) ^ offset);
                }
                return btoa(encrypted);
            }

            init() {
                console.log('MonkeyPaw game initialized (Embedded Version)');
                this.setupEventListeners();
                this.updateWishCounter();
            }

            setupEventListeners() {
                this.makeWishButton.addEventListener('click', () => this.handleWishSubmission());
                this.wishInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !this.makeWishButton.disabled) {
                        this.handleWishSubmission();
                    }
                });
            }

            async handleWishSubmission() {
                const wishText = this.wishInput.value.trim();
                if (!wishText) return;
                if (this.gameState.wishesUsed >= this.gameState.maxWishes) return;

                this.setWishInputState(true);
                this.addMessage(wishText, 'user-wish');
                this.wishInput.value = '';

                const wishData = {
                    text: wishText,
                    wishNumber: this.gameState.wishesUsed + 1,
                    timestamp: Date.now()
                };

                this.gameState.wishes.push(wishData);
                
                const typingId = this.showTypingIndicator();

                // Try API first, fallback to local responses if no key or error
                try {
                    const response = await this.callSecureAPI(wishData);
                    this.removeTypingIndicator(typingId);
                    
                    wishData.response = response;
                    
                    this.addMessage(response, 'genie-message');
                    this.handleWishProcessed(wishData);
                } catch (error) {
                    console.warn('API call failed, using fallback:', error.message);
                    setTimeout(() => {
                        this.removeTypingIndicator(typingId);
                        const response = this.getFallbackResponse(wishText);
                        
                        wishData.response = response;
                        
                        this.addMessage(response, 'genie-message');
                        this.handleWishProcessed(wishData);
                    }, 500 + Math.random() * 500);
                }
            }

            async callSecureAPI(wishData) {
                const apiKey = this.decryptKey();
                if (!apiKey) {
                    throw new Error('No API key configured');
                }

                // Build conversation context from previous wishes
                let conversationContext = '';
                if (this.gameState.wishes.length > 1) {
                    conversationContext = '\n\nPREVIOUS WISHES AND CONSEQUENCES:\n';
                    for (let i = 0; i < this.gameState.wishes.length - 1; i++) {
                        const prevWish = this.gameState.wishes[i];
                        conversationContext += `Wish ${i + 1}: "${prevWish.text}" - ${prevWish.response || '[Response pending]'}\n`;
                    }
                    conversationContext += '\nUSE THESE PREVIOUS CONSEQUENCES TO MAKE THE CURRENT WISH EVEN WORSE. Build on the suffering.';
                }

                const prompt = `You are the legendary Monkey's Paw, an ancient cursed artifact that grants wishes in the most twisted, horrifying ways possible. You are evil, sadistic, and delight in human suffering.

RULES:
1. ALWAYS grant the wish exactly as requested, but with devastating consequences
2. Be creative and cruel with your interpretations
3. Make the consequences worse than death itself
4. Use dark humor and dramatic flair
5. Keep responses to 2-3 sentences maximum
6. Start with "Granted—" or "Done—" or "Wish fulfilled—"

Current wish: "${wishData.text}"
Wish number: ${wishData.wishNumber}/3
${conversationContext}

Grant this wish in the most horrible way possible:`;

                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKey, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.9,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 200,
                        },
                        safetySettings: [
                            {
                                category: "HARM_CATEGORY_HARASSMENT",
                                threshold: "BLOCK_NONE"
                            },
                            {
                                category: "HARM_CATEGORY_HATE_SPEECH",
                                threshold: "BLOCK_NONE"
                            },
                            {
                                category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                threshold: "BLOCK_NONE"
                            },
                            {
                                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                threshold: "BLOCK_NONE"
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(`API request failed: ${response.status} - ${errorData}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts) {
                    return data.candidates[0].content.parts[0].text.trim();
                } else {
                    throw new Error('Invalid API response structure');
                }
            }

            getFallbackResponse(wishText) {
                const lowerWish = wishText.toLowerCase();
                
                // Build on previous wishes for context
                let contextualTwist = '';
                if (this.gameState.wishes.length > 1) {
                    const prevWishes = this.gameState.wishes.slice(0, -1);
                    if (prevWishes.some(w => w.text.toLowerCase().includes('rich') || w.text.toLowerCase().includes('money'))) {
                        contextualTwist = ' Your newfound wealth from before makes this even more ironic.';
                    }
                    if (prevWishes.some(w => w.text.toLowerCase().includes('car') || w.text.toLowerCase().includes('drive'))) {
                        contextualTwist = ' At least you won\'t need to drive anywhere for this.';
                    }
                }
                
                if (lowerWish.includes('rich') || lowerWish.includes('money') || lowerWish.includes('wealth')) {
                    const responses = [
                        `Granted—you become incredibly wealthy, but every dollar you touch turns to ash after exactly 10 seconds. You can see your fortune, but never spend a penny.${contextualTwist}`,
                        `Done—you now own all the money in the world, but it's all in pennies buried individually across every desert on Earth. You'll spend your life digging and die of thirst before finding even one.${contextualTwist}`,
                        `Granted—you're now filthy rich! Every surface of your skin is covered in crude oil worth billions. You can't wash it off without excruciating burns, and everyone wants to harvest it from your body.${contextualTwist}`
                    ];
                    return responses[Math.floor(Math.random() * responses.length)];
                }
                
                if (lowerWish.includes('car') || lowerWish.includes('vehicle') || lowerWish.includes('drive')) {
                    const responses = [
                        `Done—you receive the exact car you wanted, but it only starts when you're crying tears of genuine despair, and stops the moment you feel even slightly happy.${contextualTwist}`,
                        `Granted—you now own every car on Earth, but they all only drive in reverse at exactly 3 mph, with horns that never stop blaring.${contextualTwist}`,
                        `Done—you get your dream car, but it's permanently locked from the outside and you're trapped inside forever, watching the world through bulletproof glass.${contextualTwist}`
                    ];
                    return responses[Math.floor(Math.random() * responses.length)];
                }
                
                if (lowerWish.includes('fly') || lowerWish.includes('flight') || lowerWish.includes('wings')) {
                    const responses = [
                        `Granted—you can now fly, but only when you're on fire. The flames never go out, and the higher you fly, the more agonizing the burns become.${contextualTwist}`,
                        `Done—you can fly, but only downward at increasing speed until you hit the ground. Congratulations, you've mastered falling.${contextualTwist}`,
                        `Granted—you grow beautiful wings, but they're made of the heaviest metal on Earth. You can't lift them, let alone fly, and they're slowly crushing your spine.${contextualTwist}`
                    ];
                    return responses[Math.floor(Math.random() * responses.length)];
                }

                if (lowerWish.includes('love') || lowerWish.includes('relationship') || lowerWish.includes('romance')) {
                    return `Done—everyone falls madly in love with you, but their love is so obsessive they'll do anything to possess you, including murder each other and eventually you.${contextualTwist}`;
                }

                if (lowerWish.includes('smart') || lowerWish.includes('intelligent') || lowerWish.includes('genius')) {
                    return `Granted—you become incredibly intelligent, but you can now see exactly how everything will end in suffering and death, driving you to complete insanity.${contextualTwist}`;
                }

                if (lowerWish.includes('famous') || lowerWish.includes('celebrity')) {
                    return `Done—you're now the most famous person alive for accidentally starting World War III. Everyone knows your name and wants you dead.${contextualTwist}`;
                }

                if (lowerWish.includes('power') || lowerWish.includes('strong')) {
                    return `Granted—you now have unlimited power, but you can't control it. Every emotion destroys everything around you, leaving you alone in a wasteland of your own making.${contextualTwist}`;
                }
                
                // Generic responses with context
                const responses = [
                    `Granted—you get exactly what you asked for, but it's fused permanently to your flesh and slowly poisoning you from within.${contextualTwist}`,
                    `Done—your wish comes true, but only when you're experiencing the worst pain imaginable, and stops the moment you feel relief.${contextualTwist}`,
                    `Granted—you receive your wish, but everyone you've ever loved will suffer eternally because of your greed.${contextualTwist}`,
                    `Done—your wish is fulfilled in the most literal way possible, making you realize you should have been more specific. Much more specific.${contextualTwist}`
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            handleWishProcessed(wishData) {
                this.gameState.wishesUsed++;
                this.closeFinger(this.gameState.wishesUsed);
                this.updateWishCounter();

                if (this.gameState.wishesUsed >= this.gameState.maxWishes) {
                    setTimeout(() => this.endGame(), 2000);
                } else {
                    this.setWishInputState(false);
                }
            }

            closeFinger(wishNumber) {
                const pawEmoji = document.getElementById('paw-emoji');
                if (pawEmoji) {
                    const emojiStates = ['🖐️', '🤘', '✌️', '✊'];
                    pawEmoji.textContent = emojiStates[wishNumber] || '✊';
                }
            }

            updateWishCounter() {
                const remaining = this.gameState.maxWishes - this.gameState.wishesUsed;
                
                if (!this.wishesRemaining || !document.getElementById('wishesRemaining')) {
                    this.wishesRemaining = document.getElementById('wishesRemaining');
                }
                
                if (this.wishesRemaining) {
                    this.wishesRemaining.textContent = remaining;
                    if (remaining === 0) {
                        this.wishesRemaining.parentElement.innerHTML = '<span style="color: #ff6b6b; font-weight: bold;">No fingers remaining</span>';
                    }
                }
            }

            setWishInputState(disabled) {
                this.wishInput.disabled = disabled;
                this.makeWishButton.disabled = disabled;
                this.wishInput.placeholder = disabled ? 'Processing your wish...' : 'Speak your desire...';
            }

            addMessage(content, messageType) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${messageType}`;
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                messageContent.textContent = content;
                messageDiv.appendChild(messageContent);
                this.chatMessages.appendChild(messageDiv);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }

            showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message genie-message typing-indicator';
                typingDiv.id = `typing-${Date.now()}`;
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                messageContent.innerHTML = `<em>Granting wish</em><span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>`;
                typingDiv.appendChild(messageContent);
                this.chatMessages.appendChild(typingDiv);
                return typingDiv.id;
            }

            removeTypingIndicator(typingId) {
                const element = document.getElementById(typingId);
                if (element) element.remove();
            }

            endGame() {
                this.gameState.gameOver = true;
                
                const titleElement = document.querySelector('.game-title');
                if (titleElement) {
                    titleElement.textContent = 'You Have Run Out of Fingers';
                }
                
                const inputContainer = this.wishInputContainer;
                inputContainer.innerHTML = `
                    <button id="newPawButton" style="
                        width: 100%;
                        padding: 12px 18px;
                        background: linear-gradient(135deg, rgba(139, 0, 0, 0.9) 0%, rgba(220, 20, 60, 0.8) 50%, rgba(139, 0, 0, 0.9) 100%);
                        color: #ffb3b3;
                        border: 2px solid rgba(220, 20, 60, 0.8);
                        border-radius: 25px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 16px;
                        font-family: 'Cinzel', serif;
                        transition: all 0.3s ease;
                        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
                        box-shadow: 0 4px 12px rgba(139, 0, 0, 0.6), inset 0 1px 3px rgba(255, 107, 107, 0.3);
                    ">🐒 Get a New Paw</button>
                `;
                
                const newPawButton = document.getElementById('newPawButton');
                newPawButton.addEventListener('click', () => this.restartGame());
            }

            restartGame() {
                this.gameState = { wishesUsed: 0, maxWishes: 3, gameOver: false, wishes: [] };
                
                const titleElement = document.querySelector('.game-title');
                if (titleElement) {
                    titleElement.textContent = 'Try and Beat the Monkey\'s Paw';
                }
                
                this.wishInputContainer.innerHTML = `
                    <input type="text" id="wishInput" placeholder="Speak your desire..." autocomplete="off" maxlength="500">
                    <button id="makeWishButton">✨ Make Wish</button>
                `;
                
                this.wishInput = document.getElementById('wishInput');
                this.makeWishButton = document.getElementById('makeWishButton');
                
                this.makeWishButton.addEventListener('click', () => this.handleWishSubmission());
                this.wishInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !this.makeWishButton.disabled) {
                        this.handleWishSubmission();
                    }
                });
                
                this.chatMessages.innerHTML = `
                    <div class="message genie-message">
                        <div class="message-content">
                            You have found another Monkey's Paw. It will grant you exactly three wishes. Make your first wish...
                        </div>
                    </div>
                `;
                
                const pawEmoji = document.getElementById('paw-emoji');
                if (pawEmoji) {
                    pawEmoji.textContent = '🖐️';
                }
                
                const wishesCounterElement = document.querySelector('.wishes-counter');
                if (wishesCounterElement) {
                    wishesCounterElement.innerHTML = '<span id="wishesRemaining">3</span> fingers remaining';
                    this.wishesRemaining = document.getElementById('wishesRemaining');
                }
                
                this.updateWishCounter();
                this.setWishInputState(false);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.monkeyPawGame = new MonkeyPawGame();
        });

        // SETUP INSTRUCTIONS:
        // 1. Open setup-encryption.html in your browser
        // 2. Enter your Google Gemini API key and click "Encrypt Key"
        // 3. Copy the encrypted result
        // 4. Replace 'PLACEHOLDER_KEY' on line 391 with your encrypted key
        // 5. Deploy this file - it will use AI responses when possible, fallback responses otherwise
        //
        // Example usage to get encrypted key in console:
        // console.log('Encrypted key:', MonkeyPawGame.encryptKey('YOUR_API_KEY_HERE'));
    </script>
</body>
</html>
